<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± SAPRAS Digital - Aplikasi Web Inventaris</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #1e40af 0%, #7c3aed 50%, #059669 100%);
        }
        
        .app-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .app-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            padding: 1.5rem;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .stats-card {
            background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
            border: 1px solid #e0f2fe;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #10b981);
        }
        
        .stats-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15);
        }
        
        .form-section {
            background: linear-gradient(135deg, #ffffff 0%, #fefefe 100%);
            border: 2px solid #f1f5f9;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .input-field {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .table-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .table-row {
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.2s ease;
        }
        
        .table-row:hover {
            background: #f8fafc;
        }
        
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-success {
            background: #dcfce7;
            color: #166534;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-primary {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .logo-upload {
            border: 3px dashed #cbd5e1;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .logo-upload:hover {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }
        
        .logo-upload.dragover {
            border-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: all 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .edit-mode {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
        }
        
        .edit-mode .app-header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .btn-edit-active {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important;
        }
        
        .btn-edit-active span:first-child::after {
            content: ' ‚ùå';
        }
        
        .save-success {
            animation: saveSuccess 0.6s ease-out;
        }
        
        @keyframes saveSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen">
    <!-- Main App Container -->
    <div class="container mx-auto px-4 py-8">
        <div class="app-container max-w-7xl mx-auto">
            <!-- App Header -->
            <div class="app-header relative">
                <div class="flex items-center justify-between relative z-10">
                    <div class="flex items-center space-x-4">
                        <div id="schoolLogo" class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-2xl">
                            üè´
                        </div>
                        <div>
                            <h1 class="text-2xl lg:text-3xl font-bold">SAPRAS DIGITAL</h1>
                            <p class="text-blue-100 text-sm lg:text-base">SMK Nasional Bandung - Sistem Inventaris</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-blue-100">Versi 1.0</div>
                        <div class="text-xs text-blue-200" id="currentDate"></div>
                    </div>
                </div>
            </div>

            <!-- App Content -->
            <div class="p-6 lg:p-8">
                <!-- Statistics Dashboard -->
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-8">
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Total Barang</p>
                                <p class="text-3xl font-bold text-blue-600" id="totalItems">0</p>
                            </div>
                            <div class="text-4xl">üì¶</div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Kategori</p>
                                <p class="text-3xl font-bold text-green-600" id="totalCategories">0</p>
                            </div>
                            <div class="text-4xl">üè∑Ô∏è</div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Kondisi Baik</p>
                                <p class="text-3xl font-bold text-emerald-600" id="goodCondition">0</p>
                            </div>
                            <div class="text-4xl">‚úÖ</div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Perlu Perbaikan</p>
                                <p class="text-3xl font-bold text-amber-600" id="needRepair">0</p>
                            </div>
                            <div class="text-4xl">‚ö†Ô∏è</div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Total Nilai Aset</p>
                                <p class="text-2xl font-bold text-purple-600" id="totalValue">Rp 0</p>
                            </div>
                            <div class="text-4xl">üí∞</div>
                        </div>
                    </div>
                </div>

                <!-- Logo Upload Section -->
                <div class="form-section mb-8">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-3">üì∏</span>
                        Upload Logo Sekolah
                    </h2>
                    
                    <!-- Current Logo Display -->
                    <div id="currentLogoDisplay" class="mb-4 text-center hidden">
                        <div class="inline-block p-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
                            <img id="currentLogoImg" src="" alt="Logo Sekolah" class="max-w-32 max-h-32 object-contain mx-auto">
                            <p class="text-sm text-gray-600 mt-2">Logo saat ini</p>
                            <button onclick="removeLogo()" class="mt-2 px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">
                                üóëÔ∏è Hapus Logo
                            </button>
                        </div>
                    </div>
                    
                    <!-- Upload Area -->
                    <div class="logo-upload" id="logoUpload">
                        <div class="text-4xl mb-4">üñºÔ∏è</div>
                        <p class="text-gray-600 font-medium mb-3">üìÅ KLIK DI SINI UNTUK PILIH LOGO</p>
                        <p class="text-sm text-gray-500 mb-3">Atau seret & lepas file gambar di area ini</p>
                        
                        <!-- Visible Upload Button -->
                        <button type="button" onclick="document.getElementById('logoInput').click()" class="btn-primary mb-3">
                            üìÇ Pilih File Logo
                        </button>
                        
                        <div class="text-xs text-gray-400">
                            ‚úÖ Format: PNG, JPG, JPEG, GIF<br>
                            ‚úÖ Ukuran maksimal: 5MB<br>
                            ‚úÖ Bisa juga paste dengan Ctrl+V
                        </div>
                        
                        <input type="file" id="logoInput" accept="image/*,.png,.jpg,.jpeg,.gif" class="hidden">
                    </div>
                    
                    <!-- Upload Progress -->
                    <div id="uploadProgress" class="mt-4 hidden">
                        <div class="bg-blue-100 border border-blue-300 rounded-lg p-3">
                            <div class="flex items-center">
                                <div class="loading mr-3"></div>
                                <span class="text-blue-700 font-medium">Mengupload logo...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Item Form -->
                <div class="form-section">
                    <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl mr-3">‚ûï</span>
                        Tambah Barang Baru
                    </h2>
                    
                    <form id="itemForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang *</label>
                            <input type="text" id="itemName" class="input-field" placeholder="Contoh: Laptop Dell Inspiron 15" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kategori *</label>
                            <select id="itemCategory" class="input-field" required>
                                <option value="">Pilih Kategori</option>
                                <option value="ELK">ELK - Elektronik & IT</option>
                                <option value="EKL">EKL - Elektronik & Kelistrikan</option>
                                <option value="MBL">MBL - Mebel & Furniture</option>
                                <option value="OLR">OLR - Olahraga & Kesehatan</option>
                                <option value="KDR">KDR - Kendaraan & Transportasi</option>
                                <option value="ATK">ATK - Alat Tulis & Kantor</option>
                                <option value="KBN">KBN - Kebersihan & Maintenance</option>
                                <option value="LAB">LAB - Laboratorium & Praktikum</option>
                                <option value="PRP">PRP - Perpustakaan & Media</option>
                                <option value="KTR">KTR - Keamanan & Ketertiban</option>
                                <option value="MSK">MSK - Musik & Seni</option>
                                <option value="DPR">DPR - Dapur & Konsumsi</option>
                                <option value="KSH">KSH - Kesehatan & P3K</option>
                                <option value="BNG">BNG - Bangunan & Infrastruktur</option>
                                <option value="TXT">TXT - Tekstil & Pakaian</option>
                                <option value="AGR">AGR - Pertanian & Kebun</option>
                                <option value="PPU">PPU - Peralatan Praktek Umum</option>
                                <option value="PPK">PPK - Peralatan Praktek Kejuruan</option>
                                <option value="AKB">AKB - Alat Kebersihan</option>
                                <option value="AK3">AK3 - Alat Keamanan & K3</option>
                                <option value="ABI">ABI - Aset Bangunan Infrastruktur</option>
                                <option value="PUS">PUS - Perpustakaan</option>
                                <option value="MPI">MPI - Mading Papan Informasi</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi *</label>
                            <select id="itemLocation" class="input-field" required>
                                <option value="">Pilih Lokasi</option>
                                <option value="LAB">LAB - Laboratorium</option>
                                <option value="LAB-MPLB">LAB-MPLB - Lab. Komputer MPLB</option>
                                <option value="LAB-DKV">LAB-DKV - Lab. Komputer DKV</option>
                                <option value="LAB-TJKT">LAB-TJKT - Lab. Komputer TJKT</option>
                                <option value="RGR">RGR - Ruang Guru</option>
                                <option value="KTR">KTR - Kantor</option>
                                <option value="KLS">KLS - Ruang Kelas</option>
                                <option value="X-DKV">X-DKV - R. Kelas X-DKV</option>
                                <option value="XI-DKV">XI-DKV - R. Kelas XI-DKV</option>
                                <option value="XII-DKV">XII-DKV - R. Kelas XII-DKV</option>
                                <option value="X-TJKT">X-TJKT - R. Kelas X-TJKT</option>
                                <option value="XI-TJKT">XI-TJKT - R. Kelas XI-TJKT</option>
                                <option value="XII-TJKT">XII-TJKT - R. Kelas XII-TJKT</option>
                                <option value="X-MPLB">X-MPLB - R. Kelas X-MPLB</option>
                                <option value="XI-MPLB">XI-MPLB - R. Kelas XI-MPLB</option>
                                <option value="XII-MPLB">XII-MPLB - R. Kelas XII-MPLB</option>
                                <option value="PRP">PRP - Perpustakaan</option>
                                <option value="DPR">DPR - Ruang Dapur</option>
                                <option value="GDG">GDG - R. Gudang</option>
                                <option value="AUL">AUL - Aula</option>
                                <option value="LPG">LPG - Lapangan</option>
                                <option value="RKR">RKR - Ruang Kreatifitas</option>
                                <option value="MSH">MSH - Ruang Musholah</option>
                                <option value="UKS">UKS - Ruang UKS</option>
                                <option value="BKK">BKK - Ruang BKK</option>
                                <option value="SL1">SL1 - Ruang Selasar Lt 01</option>
                                <option value="SL2">SL2 - Ruang Selasar Lt 02</option>
                                <option value="OFC">OFC - Ruang Office</option>
                                <option value="POD">POD - R. Podcast Teffa</option>
                                <option value="PRC">PRC - R. Percetakan Teffa</option>
                                <option value="VID">VID - R. Video dan Fotography Teffa</option>
                                <option value="KMT">KMT - R. K-Mart Teffa</option>
                                <option value="AUL">AUL - Ruang Aula</option>
                                <option value="WD1">WD1 - Ruang Tempat Wudhu Lt1</option>
                                <option value="WD2">WD2 - Ruang Wudhu Lt 2</option>
                                <option value="OSS">OSS - Ruang OSIS</option>
                                <option value="TMU">TMU - Ruang Tamu</option>
                                <option value="RCP">RCP - Ruang Resepsion</option>
                                <option value="TS1">TS1 - Ruang Toilet Siswa</option>
                                <option value="TS2">TS2 - Ruang Toilet Siswi</option>
                                <option value="GD1">GD1 - Ruang Gudang 1</option>
                                <option value="GD2">GD2 - Ruang Gudang 2</option>
                                <option value="TGP">TGP - Ruang Toilet Guru Pria</option>
                                <option value="TGW">TGW - Ruang Toilet Guru Putri</option>
                                <option value="TPP">TPP - Ruang Toilet Perpus</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kondisi *</label>
                            <select id="itemCondition" class="input-field" required>
                                <option value="">Pilih Kondisi</option>
                                <option value="Baik">Baik</option>
                                <option value="Rusak Ringan">Rusak Ringan</option>
                                <option value="Rusak Berat">Rusak Berat</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah</label>
                            <input type="number" id="itemQuantity" class="input-field" placeholder="1" min="1" value="1">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Harga Satuan (Rp) *</label>
                            <input type="number" id="itemPrice" class="input-field" placeholder="0" min="0" step="1000" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Sumber Dana *</label>
                            <select id="itemFunding" class="input-field" required>
                                <option value="">Pilih Sumber Dana</option>
                                <option value="APBD">APBD - Anggaran Pendapatan Belanja Daerah</option>
                                <option value="BOS">BOS - Bantuan Operasional Sekolah</option>
                                <option value="APBN">APBN - Anggaran Pendapatan Belanja Negara</option>
                                <option value="Hibah">Hibah - Bantuan/Sumbangan</option>
                                <option value="Swadaya">Swadaya - Dana Mandiri Sekolah</option>
                                <option value="CSR">CSR - Corporate Social Responsibility</option>
                                <option value="Komite">Komite - Dana Komite Sekolah</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Keterangan</label>
                            <input type="text" id="itemNotes" class="input-field" placeholder="Keterangan tambahan (opsional)">
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3 flex justify-end">
                            <button type="submit" class="btn-primary flex items-center space-x-2">
                                <span>Tambah Barang</span>
                                <span id="addLoading" class="loading hidden"></span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Search and Filter Section -->
                <div class="form-section">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center">
                            <span class="text-2xl mr-3">üìã</span>
                            Daftar Inventaris
                        </h2>
                        
                        <div class="flex flex-col sm:flex-row gap-3">
                            <button id="editModeBtn" onclick="toggleEditMode()" class="btn-secondary flex items-center space-x-2" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                <span>‚úèÔ∏è</span>
                                <span>Mode Edit</span>
                            </button>
                            <button id="saveDataBtn" onclick="saveAllData()" class="btn-secondary flex items-center space-x-2" style="background: linear-gradient(135deg, #059669 0%, #047857 100%);">
                                <span>üíæ</span>
                                <span>Simpan Data</span>
                            </button>
                            <button onclick="exportToCSV()" class="btn-secondary flex items-center space-x-2">
                                <span>üìä</span>
                                <span>Export CSV</span>
                            </button>
                            <button onclick="exportToJSON()" class="btn-secondary flex items-center space-x-2" style="background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);">
                                <span>üìÑ</span>
                                <span>Export JSON</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üîç Pencarian</label>
                            <input type="text" id="searchInput" class="input-field" placeholder="Cari nama, kode, atau lokasi...">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üè∑Ô∏è Filter Kategori</label>
                            <select id="categoryFilter" class="input-field">
                                <option value="">Semua Kategori</option>
                                <option value="ELK">ELK - Elektronik & IT</option>
                                <option value="EKL">EKL - Elektronik & Kelistrikan</option>
                                <option value="MBL">MBL - Mebel & Furniture</option>
                                <option value="OLR">OLR - Olahraga & Kesehatan</option>
                                <option value="KDR">KDR - Kendaraan & Transportasi</option>
                                <option value="ATK">ATK - Alat Tulis & Kantor</option>
                                <option value="KBN">KBN - Kebersihan & Maintenance</option>
                                <option value="LAB">LAB - Laboratorium & Praktikum</option>
                                <option value="PRP">PRP - Perpustakaan & Media</option>
                                <option value="KTR">KTR - Keamanan & Ketertiban</option>
                                <option value="MSK">MSK - Musik & Seni</option>
                                <option value="DPR">DPR - Dapur & Konsumsi</option>
                                <option value="KSH">KSH - Kesehatan & P3K</option>
                                <option value="BNG">BNG - Bangunan & Infrastruktur</option>
                                <option value="TXT">TXT - Tekstil & Pakaian</option>
                                <option value="AGR">AGR - Pertanian & Kebun</option>
                                <option value="PPU">PPU - Peralatan Praktek Umum</option>
                                <option value="PPK">PPK - Peralatan Praktek Kejuruan</option>
                                <option value="AKB">AKB - Alat Kebersihan</option>
                                <option value="AK3">AK3 - Alat Keamanan & K3</option>
                                <option value="ABI">ABI - Aset Bangunan Infrastruktur</option>
                                <option value="PUS">PUS - Perpustakaan</option>
                                <option value="MPI">MPI - Mading Papan Informasi</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‚ö° Filter Kondisi</label>
                            <select id="conditionFilter" class="input-field">
                                <option value="">Semua Kondisi</option>
                                <option value="Baik">Baik</option>
                                <option value="Rusak Ringan">Rusak Ringan</option>
                                <option value="Rusak Berat">Rusak Berat</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Advanced Features Section -->
                <div class="form-section">
                    <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl mr-3">‚ö°</span>
                        Fitur Lanjutan
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button onclick="openBulkImport()" class="btn-secondary flex items-center justify-center space-x-2 p-4" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                            <span>üì•</span>
                            <span>Import Data</span>
                        </button>
                        
                        <button onclick="openReportGenerator()" class="btn-secondary flex items-center justify-center space-x-2 p-4" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);">
                            <span>üìä</span>
                            <span>Generate Laporan</span>
                        </button>
                        
                        <button onclick="openMaintenanceSchedule()" class="btn-secondary flex items-center justify-center space-x-2 p-4" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                            <span>üîß</span>
                            <span>Jadwal Maintenance</span>
                        </button>
                        
                        <button onclick="openQRScanner()" class="btn-secondary flex items-center justify-center space-x-2 p-4" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                            <span>üì±</span>
                            <span>QR Scanner</span>
                        </button>
                    </div>
                </div>

                <!-- Items Table -->
                <div class="table-container">
                    <div class="table-header">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">Data Inventaris</h3>
                            <div class="flex items-center space-x-4">
                                <select id="sortBy" class="text-sm border border-gray-300 rounded px-2 py-1">
                                    <option value="date">Urutkan: Tanggal</option>
                                    <option value="name">Urutkan: Nama</option>
                                    <option value="code">Urutkan: Kode</option>
                                    <option value="price">Urutkan: Harga</option>
                                    <option value="condition">Urutkan: Kondisi</option>
                                </select>
                                <span id="itemCount" class="text-sm text-gray-600">0 barang</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lokasi</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kondisi</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Harga Satuan</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Harga</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sumber Dana</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="itemsTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Items will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="emptyState" class="text-center py-12 hidden">
                        <div class="text-6xl mb-4">üì¶</div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Belum ada data inventaris</h3>
                        <p class="text-gray-500">Mulai dengan menambahkan barang pertama Anda</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">‚úèÔ∏è Edit Data Barang</h3>
                <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <form id="editForm" class="space-y-4">
                <input type="hidden" id="editItemId">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                    <input type="text" id="editItemName" class="input-field" required>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                        <select id="editItemCategory" class="input-field" required>
                            <option value="ELK">ELK - Elektronik & IT</option>
                            <option value="EKL">EKL - Elektronik & Kelistrikan</option>
                            <option value="MBL">MBL - Mebel & Furniture</option>
                            <option value="OLR">OLR - Olahraga & Kesehatan</option>
                            <option value="KDR">KDR - Kendaraan & Transportasi</option>
                            <option value="ATK">ATK - Alat Tulis & Kantor</option>
                            <option value="KBN">KBN - Kebersihan & Maintenance</option>
                            <option value="LAB">LAB - Laboratorium & Praktikum</option>
                            <option value="PRP">PRP - Perpustakaan & Media</option>
                            <option value="KTR">KTR - Keamanan & Ketertiban</option>
                            <option value="MSK">MSK - Musik & Seni</option>
                            <option value="DPR">DPR - Dapur & Konsumsi</option>
                            <option value="KSH">KSH - Kesehatan & P3K</option>
                            <option value="BNG">BNG - Bangunan & Infrastruktur</option>
                            <option value="TXT">TXT - Tekstil & Pakaian</option>
                            <option value="AGR">AGR - Pertanian & Kebun</option>
                            <option value="PPU">PPU - Peralatan Praktek Umum</option>
                            <option value="PPK">PPK - Peralatan Praktek Kejuruan</option>
                            <option value="AKB">AKB - Alat Kebersihan</option>
                            <option value="AK3">AK3 - Alat Keamanan & K3</option>
                            <option value="ABI">ABI - Aset Bangunan Infrastruktur</option>
                            <option value="PUS">PUS - Perpustakaan</option>
                            <option value="MPI">MPI - Mading Papan Informasi</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi</label>
                        <select id="editItemLocation" class="input-field" required>
                            <option value="LAB">LAB - Laboratorium</option>
                            <option value="LAB-MPLB">LAB-MPLB - Lab. Komputer MPLB</option>
                            <option value="LAB-DKV">LAB-DKV - Lab. Komputer DKV</option>
                            <option value="LAB-TJKT">LAB-TJKT - Lab. Komputer TJKT</option>
                            <option value="RGR">RGR - Ruang Guru</option>
                            <option value="KTR">KTR - Kantor</option>
                            <option value="KLS">KLS - Ruang Kelas</option>
                            <option value="X-DKV">X-DKV - R. Kelas X-DKV</option>
                            <option value="XI-DKV">XI-DKV - R. Kelas XI-DKV</option>
                            <option value="XII-DKV">XII-DKV - R. Kelas XII-DKV</option>
                            <option value="X-TJKT">X-TJKT - R. Kelas X-TJKT</option>
                            <option value="XI-TJKT">XI-TJKT - R. Kelas XI-TJKT</option>
                            <option value="XII-TJKT">XII-TJKT - R. Kelas XII-TJKT</option>
                            <option value="X-MPLB">X-MPLB - R. Kelas X-MPLB</option>
                            <option value="XI-MPLB">XI-MPLB - R. Kelas XI-MPLB</option>
                            <option value="XII-MPLB">XII-MPLB - R. Kelas XII-MPLB</option>
                            <option value="PRP">PRP - Perpustakaan</option>
                            <option value="DPR">DPR - Ruang Dapur</option>
                            <option value="GDG">GDG - R. Gudang</option>
                            <option value="AUL">AUL - Aula</option>
                            <option value="LPG">LPG - Lapangan</option>
                            <option value="RKR">RKR - Ruang Kreatifitas</option>
                            <option value="MSH">MSH - Ruang Musholah</option>
                            <option value="UKS">UKS - Ruang UKS</option>
                            <option value="BKK">BKK - Ruang BKK</option>
                            <option value="SL1">SL1 - Ruang Selasar Lt 01</option>
                            <option value="SL2">SL2 - Ruang Selasar Lt 02</option>
                            <option value="OFC">OFC - Ruang Office</option>
                            <option value="POD">POD - R. Podcast Teffa</option>
                            <option value="PRC">PRC - R. Percetakan Teffa</option>
                            <option value="VID">VID - R. Video dan Fotography Teffa</option>
                            <option value="KMT">KMT - R. K-Mart Teffa</option>
                            <option value="AUL">AUL - Ruang Aula</option>
                            <option value="WD1">WD1 - Ruang Tempat Wudhu Lt1</option>
                            <option value="WD2">WD2 - Ruang Wudhu Lt 2</option>
                            <option value="OSS">OSS - Ruang OSIS</option>
                            <option value="TMU">TMU - Ruang Tamu</option>
                            <option value="RCP">RCP - Ruang Resepsion</option>
                            <option value="TS1">TS1 - Ruang Toilet Siswa</option>
                            <option value="TS2">TS2 - Ruang Toilet Siswi</option>
                            <option value="GD1">GD1 - Ruang Gudang 1</option>
                            <option value="GD2">GD2 - Ruang Gudang 2</option>
                            <option value="TGP">TGP - Ruang Toilet Guru Pria</option>
                            <option value="TGW">TGW - Ruang Toilet Guru Putri</option>
                            <option value="TPP">TPP - Ruang Toilet Perpus</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kondisi</label>
                        <select id="editItemCondition" class="input-field" required>
                            <option value="Baik">Baik</option>
                            <option value="Rusak Ringan">Rusak Ringan</option>
                            <option value="Rusak Berat">Rusak Berat</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah</label>
                        <input type="number" id="editItemQuantity" class="input-field" min="1" required>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Harga Satuan (Rp)</label>
                    <input type="number" id="editItemPrice" class="input-field" min="0" step="1000" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Sumber Dana</label>
                    <select id="editItemFunding" class="input-field" required>
                        <option value="APBD">APBD - Anggaran Pendapatan Belanja Daerah</option>
                        <option value="BOS">BOS - Bantuan Operasional Sekolah</option>
                        <option value="APBN">APBN - Anggaran Pendapatan Belanja Negara</option>
                        <option value="Hibah">Hibah - Bantuan/Sumbangan</option>
                        <option value="Swadaya">Swadaya - Dana Mandiri Sekolah</option>
                        <option value="CSR">CSR - Corporate Social Responsibility</option>
                        <option value="Komite">Komite - Dana Komite Sekolah</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Keterangan</label>
                    <input type="text" id="editItemNotes" class="input-field">
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeEditModal()" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                        Batal
                    </button>
                    <button type="submit" class="btn-primary">
                        Update Barang
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Import Modal -->
    <div id="bulkImportModal" class="modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">üì• Import Data Massal</h3>
                <button onclick="closeBulkImportModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Format CSV</label>
                    <div class="bg-gray-50 p-3 rounded-lg text-xs font-mono">
                        Nama,Kategori,Lokasi,Kondisi,Jumlah,Harga,Sumber Dana,Keterangan<br>
                        "Laptop Dell","ELK","LAB","Baik",1,8500000,"BOS","Untuk pembelajaran"
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Paste Data CSV</label>
                    <textarea id="csvData" class="input-field h-32" placeholder="Paste data CSV di sini..."></textarea>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeBulkImportModal()" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200">
                        Batal
                    </button>
                    <button onclick="processBulkImport()" class="btn-primary">
                        Import Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Generator Modal -->
    <div id="reportModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">üìä Generate Laporan</h3>
                <button onclick="closeReportModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Laporan</label>
                    <select id="reportType" class="input-field">
                        <option value="summary">Ringkasan Inventaris</option>
                        <option value="category">Laporan per Kategori</option>
                        <option value="location">Laporan per Lokasi</option>
                        <option value="condition">Laporan Kondisi Barang</option>
                        <option value="value">Laporan Nilai Aset</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Format Output</label>
                    <select id="reportFormat" class="input-field">
                        <option value="html">HTML (Print)</option>
                        <option value="csv">CSV</option>
                        <option value="json">JSON</option>
                    </select>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeReportModal()" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200">
                    Batal
                </button>
                <button onclick="generateReport()" class="btn-primary">
                    Generate Laporan
                </button>
            </div>
        </div>
    </div>

    <!-- Maintenance Schedule Modal -->
    <div id="maintenanceModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">üîß Jadwal Maintenance</h3>
                <button onclick="closeMaintenanceModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <div class="mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="stats-card">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-red-600" id="urgentMaintenance">0</div>
                            <div class="text-sm text-gray-600">Perlu Segera</div>
                        </div>
                    </div>
                    <div class="stats-card">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-yellow-600" id="scheduledMaintenance">0</div>
                            <div class="text-sm text-gray-600">Terjadwal</div>
                        </div>
                    </div>
                    <div class="stats-card">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600" id="completedMaintenance">0</div>
                            <div class="text-sm text-gray-600">Selesai</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="maintenanceList" class="space-y-3 max-h-96 overflow-y-auto">
                <!-- Maintenance items will be populated here -->
            </div>
            
            <div class="flex justify-end mt-6">
                <button onclick="closeMaintenanceModal()" class="btn-primary">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- QR Scanner Modal -->
    <div id="qrScannerModal" class="modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">üì± QR Code Scanner</h3>
                <button onclick="closeQRScannerModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <div class="text-center space-y-4">
                <div class="bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-8">
                    <div class="text-6xl mb-4">üì±</div>
                    <p class="text-gray-600 mb-4">Fitur QR Scanner akan tersedia dalam versi mendatang</p>
                    <p class="text-sm text-gray-500">Saat ini Anda dapat menggunakan pencarian manual atau filter untuk menemukan barang</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Atau masukkan kode barang manual</label>
                    <div class="flex space-x-2">
                        <input type="text" id="manualCode" class="input-field flex-1" placeholder="Contoh: ELK-001">
                        <button onclick="searchByCode()" class="btn-primary">
                            Cari
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Global variables
        let items = JSON.parse(localStorage.getItem('saprasItems')) || [];
        let schoolLogo = localStorage.getItem('schoolLogo') || null;
        let editingItemId = null;
        let isEditMode = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadSchoolLogo();
            renderItems();
            updateStatistics();
            setupEventListeners();
            updateCurrentDate();
        });

        function initializeApp() {
            // Add some sample data if empty
            if (items.length === 0) {
                const sampleItems = [
                    {
                        id: generateId(),
                        code: 'ELK-001',
                        name: 'Laptop Dell Inspiron 15',
                        category: 'ELK',
                        location: 'LAB',
                        condition: 'Baik',
                        quantity: 1,
                        price: 8500000,
                        funding: 'BOS',
                        notes: 'Untuk pembelajaran programming',
                        date: '2024-01-15'
                    },
                    {
                        id: generateId(),
                        code: 'MBL-001',
                        name: 'Meja Kayu Jati',
                        category: 'MBL',
                        location: 'RGR',
                        condition: 'Baik',
                        quantity: 5,
                        price: 750000,
                        funding: 'APBD',
                        notes: 'Meja guru ruang kelas',
                        date: '2024-01-15'
                    },
                    {
                        id: generateId(),
                        code: 'OLR-001',
                        name: 'Bola Sepak Nike',
                        category: 'OLR',
                        location: 'LPG',
                        condition: 'Rusak Ringan',
                        quantity: 3,
                        price: 250000,
                        funding: 'Swadaya',
                        notes: 'Perlu dipompa ulang',
                        date: '2024-01-15'
                    }
                ];
                items = sampleItems;
                saveItems();
            }
        }

        function setupEventListeners() {
            // Form submission
            document.getElementById('itemForm').addEventListener('submit', handleAddItem);
            document.getElementById('editForm').addEventListener('submit', handleEditItem);
            
            // Search and filter
            document.getElementById('searchInput').addEventListener('input', filterItems);
            document.getElementById('categoryFilter').addEventListener('change', filterItems);
            document.getElementById('conditionFilter').addEventListener('change', filterItems);
            document.getElementById('sortBy').addEventListener('change', sortItems);
            
            // Logo upload - Fixed implementation
            const logoUpload = document.getElementById('logoUpload');
            const logoInput = document.getElementById('logoInput');
            
            // Click anywhere in upload area to trigger file selection
            logoUpload.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Upload area clicked');
                logoInput.click();
            });
            
            // File input change event
            logoInput.addEventListener('change', function(e) {
                console.log('File input changed');
                if (e.target.files && e.target.files[0]) {
                    handleLogoUpload(e.target.files[0]);
                }
            });
            
            // Drag and drop events
            logoUpload.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                logoUpload.classList.add('dragover');
                console.log('Drag over');
            });
            
            logoUpload.addEventListener('dragleave', function(e) {
                e.preventDefault();
                e.stopPropagation();
                logoUpload.classList.remove('dragover');
                console.log('Drag leave');
            });
            
            logoUpload.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                logoUpload.classList.remove('dragover');
                console.log('File dropped');
                
                const files = e.dataTransfer.files;
                if (files && files[0]) {
                    handleLogoUpload(files[0]);
                }
            });
            
            // Paste event for logo
            document.addEventListener('paste', function(e) {
                const items = e.clipboardData?.items;
                if (items) {
                    for (let item of items) {
                        if (item.type.indexOf('image') !== -1) {
                            const file = item.getAsFile();
                            if (file) {
                                handleLogoUpload(file);
                                break;
                            }
                        }
                    }
                }
            });
            
            // Prevent default drag behaviors on document
            document.addEventListener('dragover', (e) => e.preventDefault());
            document.addEventListener('drop', (e) => e.preventDefault());
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function generateCode(category) {
            const categoryItems = items.filter(item => item.category === category);
            const nextNumber = categoryItems.length + 1;
            return `${category}-${nextNumber.toString().padStart(3, '0')}`;
        }

        function handleAddItem(e) {
            e.preventDefault();
            
            const loadingSpinner = document.getElementById('addLoading');
            loadingSpinner.classList.remove('hidden');
            
            setTimeout(() => {
                const formData = new FormData(e.target);
                const category = document.getElementById('itemCategory').value;
                
                const newItem = {
                    id: generateId(),
                    code: generateCode(category),
                    name: document.getElementById('itemName').value,
                    category: category,
                    location: document.getElementById('itemLocation').value,
                    condition: document.getElementById('itemCondition').value,
                    quantity: parseInt(document.getElementById('itemQuantity').value) || 1,
                    price: parseInt(document.getElementById('itemPrice').value) || 0,
                    funding: document.getElementById('itemFunding').value,
                    notes: document.getElementById('itemNotes').value,
                    date: new Date().toISOString().split('T')[0]
                };
                
                items.push(newItem);
                saveItems();
                renderItems();
                updateStatistics();
                
                // Reset form
                e.target.reset();
                
                loadingSpinner.classList.add('hidden');
                showNotification('Barang berhasil ditambahkan!', 'success');
            }, 1000);
        }

        function handleEditItem(e) {
            e.preventDefault();
            
            const itemId = document.getElementById('editItemId').value;
            const itemIndex = items.findIndex(item => item.id === itemId);
            
            if (itemIndex !== -1) {
                items[itemIndex] = {
                    ...items[itemIndex],
                    name: document.getElementById('editItemName').value,
                    category: document.getElementById('editItemCategory').value,
                    location: document.getElementById('editItemLocation').value,
                    condition: document.getElementById('editItemCondition').value,
                    quantity: parseInt(document.getElementById('editItemQuantity').value),
                    price: parseInt(document.getElementById('editItemPrice').value) || 0,
                    funding: document.getElementById('editItemFunding').value,
                    notes: document.getElementById('editItemNotes').value
                };
                
                saveItems();
                renderItems();
                updateStatistics();
                closeEditModal();
                showNotification('Data barang berhasil diupdate!', 'success');
            }
        }

        function editItem(id) {
            const item = items.find(item => item.id === id);
            if (item) {
                document.getElementById('editItemId').value = item.id;
                document.getElementById('editItemName').value = item.name;
                document.getElementById('editItemCategory').value = item.category;
                document.getElementById('editItemLocation').value = item.location;
                document.getElementById('editItemCondition').value = item.condition;
                document.getElementById('editItemQuantity').value = item.quantity;
                document.getElementById('editItemPrice').value = item.price || 0;
                document.getElementById('editItemFunding').value = item.funding || 'BOS';
                document.getElementById('editItemNotes').value = item.notes || '';
                
                document.getElementById('editModal').classList.add('active');
            }
        }

        function deleteItem(id) {
            if (confirm('Apakah Anda yakin ingin menghapus barang ini?')) {
                items = items.filter(item => item.id !== id);
                saveItems();
                renderItems();
                updateStatistics();
                showNotification('Barang berhasil dihapus!', 'success');
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
        }

        function generateLabel(id) {
            const item = items.find(item => item.id === id);
            if (!item) return;
            
            const labelWindow = window.open('', '_blank');
            const logoSrc = schoolLogo || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iMTIiIGZpbGw9IiMzQjgyRjYiLz4KPHN2ZyB4PSIxNiIgeT0iMTYiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAzbDggNHY2YzAgNS41NS0zLjg0IDEwLjc0LTkgMTItNS4xNi0xLjI2LTktNi40NS05LTEyVjdsOC00eiIvPgo8L3N2Zz4KPC9zdmc+';
            
            labelWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Label - ${item.code}</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 0; 
                            padding: 20px; 
                            background: white;
                        }
                        .label { 
                            width: 8cm; 
                            height: 5cm; 
                            border: 2px solid #333; 
                            padding: 10px; 
                            text-align: center; 
                            background: white;
                            box-sizing: border-box;
                        }
                        .header { 
                            font-size: 10px; 
                            font-weight: bold; 
                            margin-bottom: 5px; 
                        }
                        .logo { 
                            width: 30px; 
                            height: 30px; 
                            margin: 0 auto 5px; 
                        }
                        .barcode { 
                            margin: 10px 0; 
                        }
                        .info { 
                            font-size: 9px; 
                            line-height: 1.2; 
                        }
                        .code { 
                            font-weight: bold; 
                            font-size: 10px; 
                        }
                        @media print {
                            body { margin: 0; padding: 0; }
                            .label { border: 1px solid #000; }
                        }
                    </style>
                    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
                </head>
                <body>
                    <div class="label">
                        <div class="header">SMK NASIONAL BANDUNG</div>
                        <div style="font-size: 8px; color: #666; margin-bottom: 8px;">INVENTARIS SARANA & PRASARANA</div>
                        
                        <div class="barcode">
                            <canvas id="barcode"></canvas>
                        </div>
                        
                        <div class="info">
                            <div style="font-weight: bold; margin-bottom: 2px;">${item.name}</div>
                            <div>Kode: <span class="code">${item.code}</span></div>
                            <div>Lokasi: ${item.location}</div>
                            <div>Kondisi: ${item.condition}</div>
                            <div>Dana: ${item.funding || 'BOS'}</div>
                        </div>
                        
                        <div style="font-size: 7px; color: #999; margin-top: 8px;">
                            Generated: ${new Date().toLocaleDateString('id-ID')}
                        </div>
                    </div>
                    
                    <script>
                        JsBarcode("#barcode", "${item.code}", {
                            format: "CODE128",
                            width: 1.5,
                            height: 30,
                            displayValue: false,
                            margin: 0
                        });
                        
                        setTimeout(() => {
                            window.print();
                        }, 1000);
                    </script>
                <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a563a0624d9b07',t:'MTc1NDM4NzQxNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
                </html>
            `);
        }

        function filterItems() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const conditionFilter = document.getElementById('conditionFilter').value;
            
            const filteredItems = items.filter(item => {
                const matchesSearch = !searchTerm || 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.code.toLowerCase().includes(searchTerm) ||
                    item.location.toLowerCase().includes(searchTerm) ||
                    (item.notes && item.notes.toLowerCase().includes(searchTerm));
                
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                const matchesCondition = !conditionFilter || item.condition === conditionFilter;
                
                return matchesSearch && matchesCategory && matchesCondition;
            });
            
            renderItems(filteredItems);
        }

        function renderItems(itemsToRender = items) {
            const tbody = document.getElementById('itemsTableBody');
            const emptyState = document.getElementById('emptyState');
            const itemCount = document.getElementById('itemCount');
            
            if (itemsToRender.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                itemCount.textContent = '0 barang';
                return;
            }
            
            emptyState.classList.add('hidden');
            itemCount.textContent = `${itemsToRender.length} barang`;
            
            tbody.innerHTML = itemsToRender.map(item => `
                <tr class="table-row">
                    <td class="px-4 py-3 text-sm font-medium text-gray-900">${item.code}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${item.name}</td>
                    <td class="px-4 py-3 text-sm">
                        <span class="badge badge-${getCategoryColor(item.category)}">${item.category}</span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-900">${item.location}</td>
                    <td class="px-4 py-3 text-sm">
                        <span class="badge badge-${getConditionColor(item.condition)}">${item.condition}</span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-900">${item.quantity}</td>
                    <td class="px-4 py-3 text-sm text-gray-900 font-medium">${formatCurrency(item.price || 0)}</td>
                    <td class="px-4 py-3 text-sm text-gray-900 font-bold text-green-600">${formatCurrency((item.price || 0) * item.quantity)}</td>
                    <td class="px-4 py-3 text-sm">
                        <span class="badge badge-${getFundingColor(item.funding || 'BOS')}">${item.funding || 'BOS'}</span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500">${formatDate(item.date)}</td>
                    <td class="px-4 py-3 text-sm space-x-2">
                        <button onclick="editItem('${item.id}')" class="text-blue-600 hover:text-blue-800 font-medium">
                            ‚úèÔ∏è Edit
                        </button>
                        <button onclick="deleteItem('${item.id}')" class="text-red-600 hover:text-red-800 font-medium">
                            üóëÔ∏è Hapus
                        </button>
                        <button onclick="generateLabel('${item.id}')" class="text-green-600 hover:text-green-800 font-medium">
                            üè∑Ô∏è Label
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getCategoryColor(category) {
            const colors = {
                'ELK': 'primary',
                'EKL': 'warning',
                'MBL': 'success',
                'OLR': 'warning',
                'KDR': 'danger',
                'ATK': 'primary',
                'KBN': 'success',
                'LAB': 'warning',
                'PRP': 'danger',
                'KTR': 'primary',
                'MSK': 'success',
                'DPR': 'warning',
                'KSH': 'danger',
                'BNG': 'primary',
                'TXT': 'success',
                'AGR': 'warning',
                'PPU': 'primary',
                'PPK': 'success',
                'AKB': 'warning',
                'AK3': 'danger',
                'ABI': 'primary',
                'PUS': 'success',
                'MPI': 'warning'
            };
            return colors[category] || 'primary';
        }

        function getConditionColor(condition) {
            const colors = {
                'Baik': 'success',
                'Rusak Ringan': 'warning',
                'Rusak Berat': 'danger'
            };
            return colors[condition] || 'primary';
        }

        function getFundingColor(funding) {
            const colors = {
                'APBD': 'primary',
                'BOS': 'success',
                'APBN': 'warning',
                'Hibah': 'danger',
                'Swadaya': 'primary',
                'CSR': 'success',
                'Komite': 'warning',
                'Lainnya': 'danger'
            };
            return colors[funding] || 'primary';
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('id-ID');
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function updateStatistics() {
            const totalItems = items.reduce((sum, item) => sum + item.quantity, 0);
            const categories = [...new Set(items.map(item => item.category))].length;
            const goodCondition = items.filter(item => item.condition === 'Baik').reduce((sum, item) => sum + item.quantity, 0);
            const needRepair = items.filter(item => item.condition !== 'Baik').reduce((sum, item) => sum + item.quantity, 0);
            const totalValue = items.reduce((sum, item) => sum + ((item.price || 0) * item.quantity), 0);
            
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('totalCategories').textContent = categories;
            document.getElementById('goodCondition').textContent = goodCondition;
            document.getElementById('needRepair').textContent = needRepair;
            document.getElementById('totalValue').textContent = formatCurrency(totalValue);
        }

        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', options);
        }

        // Logo upload functions
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.add('dragover');
            console.log('Drag over detected');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
            
            console.log('Drop detected');
            const files = e.dataTransfer.files;
            console.log('Files dropped:', files.length);
            
            if (files.length > 0) {
                const file = files[0];
                console.log('Processing dropped file:', file.name);
                processLogoFile(file);
            }
        }

        function handleLogoUpload(file) {
            console.log('Processing logo file:', file ? file.name : 'no file');
            if (file) {
                processLogoFile(file);
            }
        }

        function handlePaste(e) {
            const items = e.clipboardData.items;
            for (let item of items) {
                if (item.type.indexOf('image') !== -1) {
                    const file = item.getAsFile();
                    processLogoFile(file);
                    break;
                }
            }
        }

        function processLogoFile(file) {
            console.log('Processing file:', file.name, file.type, file.size);
            
            // Validate file type
            const validTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type.toLowerCase())) {
                showNotification('‚ùå File harus berupa gambar! (PNG, JPG, JPEG, GIF, WebP)', 'error');
                return;
            }
            
            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('‚ùå Ukuran file maksimal 5MB!', 'error');
                return;
            }
            
            // Show upload progress
            const uploadProgress = document.getElementById('uploadProgress');
            uploadProgress.classList.remove('hidden');
            
            // Create FileReader
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const imageData = event.target.result;
                    console.log('Image data loaded, length:', imageData.length);
                    
                    // Save to localStorage
                    schoolLogo = imageData;
                    localStorage.setItem('schoolLogo', schoolLogo);
                    
                    // Update display
                    loadSchoolLogo();
                    
                    // Hide progress and show success
                    uploadProgress.classList.add('hidden');
                    showNotification('‚úÖ Logo berhasil diupload!', 'success');
                    
                    console.log('Logo saved successfully');
                    
                } catch (error) {
                    console.error('Error saving logo:', error);
                    uploadProgress.classList.add('hidden');
                    showNotification('‚ùå Gagal menyimpan logo: ' + error.message, 'error');
                }
            };
            
            reader.onerror = function(error) {
                console.error('FileReader error:', error);
                uploadProgress.classList.add('hidden');
                showNotification('‚ùå Gagal membaca file!', 'error');
            };
            
            // Start reading the file
            reader.readAsDataURL(file);
        }

        function loadSchoolLogo() {
            const logoElement = document.getElementById('schoolLogo');
            const currentLogoDisplay = document.getElementById('currentLogoDisplay');
            const currentLogoImg = document.getElementById('currentLogoImg');
            
            if (schoolLogo) {
                // Update header logo
                logoElement.innerHTML = `<img src="${schoolLogo}" alt="Logo Sekolah" class="w-full h-full object-cover rounded-full">`;
                
                // Show current logo display
                currentLogoImg.src = schoolLogo;
                currentLogoDisplay.classList.remove('hidden');
                
                console.log('Logo loaded successfully');
            } else {
                // Reset to default
                logoElement.innerHTML = 'üè´';
                currentLogoDisplay.classList.add('hidden');
            }
        }
        
        function removeLogo() {
            if (confirm('Apakah Anda yakin ingin menghapus logo?')) {
                schoolLogo = null;
                localStorage.removeItem('schoolLogo');
                loadSchoolLogo();
                showNotification('üóëÔ∏è Logo berhasil dihapus!', 'success');
            }
        }

        // Export functions
        function exportToCSV() {
            const headers = ['Kode', 'Nama', 'Kategori', 'Lokasi', 'Kondisi', 'Jumlah', 'Harga Satuan', 'Total Harga', 'Sumber Dana', 'Keterangan', 'Tanggal'];
            const csvContent = [
                headers.join(','),
                ...items.map(item => [
                    item.code,
                    `"${item.name}"`,
                    item.category,
                    item.location,
                    item.condition,
                    item.quantity,
                    item.price || 0,
                    (item.price || 0) * item.quantity,
                    item.funding || 'BOS',
                    `"${item.notes || ''}"`,
                    item.date
                ].join(','))
            ].join('\n');
            
            // Create text area for user to copy
            const textArea = document.createElement('textarea');
            textArea.value = csvContent;
            textArea.style.position = 'fixed';
            textArea.style.top = '50%';
            textArea.style.left = '50%';
            textArea.style.transform = 'translate(-50%, -50%)';
            textArea.style.width = '80%';
            textArea.style.height = '60%';
            textArea.style.zIndex = '9999';
            textArea.style.background = 'white';
            textArea.style.border = '2px solid #3b82f6';
            textArea.style.borderRadius = '8px';
            textArea.style.padding = '1rem';
            textArea.style.fontSize = '12px';
            textArea.style.fontFamily = 'monospace';
            
            document.body.appendChild(textArea);
            textArea.select();
            textArea.focus();
            
            // Try to copy to clipboard
            try {
                navigator.clipboard.writeText(csvContent);
                showNotification('Data CSV berhasil disalin ke clipboard!', 'success');
            } catch (err) {
                showNotification('Silakan copy manual data CSV dari text area!', 'success');
            }
            
            // Remove text area after 10 seconds
            setTimeout(() => {
                if (document.body.contains(textArea)) {
                    document.body.removeChild(textArea);
                }
            }, 10000);
        }

        function exportToJSON() {
            const jsonContent = JSON.stringify(items, null, 2);
            
            // Create text area for user to copy
            const textArea = document.createElement('textarea');
            textArea.value = jsonContent;
            textArea.style.position = 'fixed';
            textArea.style.top = '50%';
            textArea.style.left = '50%';
            textArea.style.transform = 'translate(-50%, -50%)';
            textArea.style.width = '80%';
            textArea.style.height = '60%';
            textArea.style.zIndex = '9999';
            textArea.style.background = 'white';
            textArea.style.border = '2px solid #7c3aed';
            textArea.style.borderRadius = '8px';
            textArea.style.padding = '1rem';
            textArea.style.fontSize = '12px';
            textArea.style.fontFamily = 'monospace';
            
            document.body.appendChild(textArea);
            textArea.select();
            textArea.focus();
            
            // Try to copy to clipboard
            try {
                navigator.clipboard.writeText(jsonContent);
                showNotification('Backup JSON berhasil disalin ke clipboard!', 'success');
            } catch (err) {
                showNotification('Silakan copy manual data JSON dari text area!', 'success');
            }
            
            // Remove text area after 10 seconds
            setTimeout(() => {
                if (document.body.contains(textArea)) {
                    document.body.removeChild(textArea);
                }
            }, 10000);
        }

        // Utility functions
        function saveItems() {
            localStorage.setItem('saprasItems', JSON.stringify(items));
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('editModal');
            if (e.target === modal) {
                closeEditModal();
            }
        });

        // Edit Mode Functions
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const appContainer = document.querySelector('.app-container');
            const editBtn = document.getElementById('editModeBtn');
            const editBtnText = editBtn.querySelector('span:last-child');
            
            if (isEditMode) {
                appContainer.classList.add('edit-mode');
                editBtn.classList.add('btn-edit-active');
                editBtnText.textContent = 'Keluar Edit';
                showNotification('Mode Edit Aktif - Anda dapat mengedit data', 'success');
            } else {
                appContainer.classList.remove('edit-mode');
                editBtn.classList.remove('btn-edit-active');
                editBtnText.textContent = 'Mode Edit';
                showNotification('Mode Edit Dinonaktifkan', 'success');
            }
        }
        
        function saveAllData() {
            const saveBtn = document.getElementById('saveDataBtn');
            const originalText = saveBtn.querySelector('span:last-child').textContent;
            
            // Show loading state
            saveBtn.querySelector('span:last-child').textContent = 'Menyimpan...';
            saveBtn.disabled = true;
            
            // Simulate save process
            setTimeout(() => {
                // Save to localStorage (already done automatically, but we can add backup)
                try {
                    localStorage.setItem('saprasItems', JSON.stringify(items));
                    localStorage.setItem('saprasBackup', JSON.stringify({
                        items: items,
                        timestamp: new Date().toISOString(),
                        version: '1.0'
                    }));
                    
                    // Success animation
                    saveBtn.classList.add('save-success');
                    saveBtn.querySelector('span:last-child').textContent = 'Tersimpan!';
                    
                    setTimeout(() => {
                        saveBtn.classList.remove('save-success');
                        saveBtn.querySelector('span:last-child').textContent = originalText;
                        saveBtn.disabled = false;
                    }, 2000);
                    
                    showNotification('Semua data berhasil disimpan!', 'success');
                    
                } catch (error) {
                    saveBtn.querySelector('span:last-child').textContent = 'Gagal!';
                    setTimeout(() => {
                        saveBtn.querySelector('span:last-child').textContent = originalText;
                        saveBtn.disabled = false;
                    }, 2000);
                    
                    showNotification('Gagal menyimpan data!', 'error');
                }
            }, 1500);
        }

        // Advanced Features Functions
        function openBulkImport() {
            document.getElementById('bulkImportModal').classList.add('active');
        }
        
        function closeBulkImportModal() {
            document.getElementById('bulkImportModal').classList.remove('active');
            document.getElementById('csvData').value = '';
        }
        
        function processBulkImport() {
            const csvData = document.getElementById('csvData').value.trim();
            if (!csvData) {
                showNotification('Silakan masukkan data CSV!', 'error');
                return;
            }
            
            try {
                const lines = csvData.split('\n');
                let importedCount = 0;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    // Parse CSV line (simple parsing)
                    const values = line.split(',').map(val => val.replace(/"/g, '').trim());
                    
                    if (values.length >= 6) {
                        const category = values[1] || 'ELK';
                        const newItem = {
                            id: generateId(),
                            code: generateCode(category),
                            name: values[0] || 'Barang Baru',
                            category: category,
                            location: values[2] || 'LAB',
                            condition: values[3] || 'Baik',
                            quantity: parseInt(values[4]) || 1,
                            price: parseInt(values[5]) || 0,
                            funding: values[6] || 'BOS',
                            notes: values[7] || '',
                            date: new Date().toISOString().split('T')[0]
                        };
                        
                        items.push(newItem);
                        importedCount++;
                    }
                }
                
                if (importedCount > 0) {
                    saveItems();
                    renderItems();
                    updateStatistics();
                    closeBulkImportModal();
                    showNotification(`Berhasil import ${importedCount} barang!`, 'success');
                } else {
                    showNotification('Tidak ada data valid untuk diimport!', 'error');
                }
                
            } catch (error) {
                showNotification('Error parsing CSV: ' + error.message, 'error');
            }
        }
        
        function openReportGenerator() {
            document.getElementById('reportModal').classList.add('active');
        }
        
        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
        }
        
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const reportFormat = document.getElementById('reportFormat').value;
            
            let reportData = '';
            let reportTitle = '';
            
            switch (reportType) {
                case 'summary':
                    reportTitle = 'Ringkasan Inventaris';
                    reportData = generateSummaryReport();
                    break;
                case 'category':
                    reportTitle = 'Laporan per Kategori';
                    reportData = generateCategoryReport();
                    break;
                case 'location':
                    reportTitle = 'Laporan per Lokasi';
                    reportData = generateLocationReport();
                    break;
                case 'condition':
                    reportTitle = 'Laporan Kondisi Barang';
                    reportData = generateConditionReport();
                    break;
                case 'value':
                    reportTitle = 'Laporan Nilai Aset';
                    reportData = generateValueReport();
                    break;
            }
            
            if (reportFormat === 'html') {
                openReportWindow(reportTitle, reportData);
            } else if (reportFormat === 'csv') {
                copyToClipboard(reportData, 'CSV');
            } else if (reportFormat === 'json') {
                copyToClipboard(JSON.stringify(reportData, null, 2), 'JSON');
            }
            
            closeReportModal();
        }
        
        function generateSummaryReport() {
            const totalItems = items.reduce((sum, item) => sum + item.quantity, 0);
            const totalValue = items.reduce((sum, item) => sum + ((item.price || 0) * item.quantity), 0);
            const categories = [...new Set(items.map(item => item.category))];
            const locations = [...new Set(items.map(item => item.location))];
            
            return `
                <div class="report-summary">
                    <h2>Ringkasan Inventaris</h2>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <strong>Total Barang:</strong> ${totalItems} unit
                        </div>
                        <div class="stat-item">
                            <strong>Total Nilai Aset:</strong> ${formatCurrency(totalValue)}
                        </div>
                        <div class="stat-item">
                            <strong>Jumlah Kategori:</strong> ${categories.length}
                        </div>
                        <div class="stat-item">
                            <strong>Jumlah Lokasi:</strong> ${locations.length}
                        </div>
                    </div>
                    
                    <h3>Detail per Kategori</h3>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Kategori</th>
                                <th>Jumlah Barang</th>
                                <th>Total Nilai</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${categories.map(cat => {
                                const catItems = items.filter(item => item.category === cat);
                                const catTotal = catItems.reduce((sum, item) => sum + item.quantity, 0);
                                const catValue = catItems.reduce((sum, item) => sum + ((item.price || 0) * item.quantity), 0);
                                return `
                                    <tr>
                                        <td>${cat}</td>
                                        <td>${catTotal}</td>
                                        <td>${formatCurrency(catValue)}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function generateCategoryReport() {
            const categories = [...new Set(items.map(item => item.category))];
            
            return categories.map(category => {
                const categoryItems = items.filter(item => item.category === category);
                const totalValue = categoryItems.reduce((sum, item) => sum + ((item.price || 0) * item.quantity), 0);
                
                return `
                    <div class="category-section">
                        <h3>Kategori: ${category}</h3>
                        <p><strong>Total Barang:</strong> ${categoryItems.length} jenis, ${categoryItems.reduce((sum, item) => sum + item.quantity, 0)} unit</p>
                        <p><strong>Total Nilai:</strong> ${formatCurrency(totalValue)}</p>
                        
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>Kode</th>
                                    <th>Nama</th>
                                    <th>Lokasi</th>
                                    <th>Kondisi</th>
                                    <th>Jumlah</th>
                                    <th>Harga</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${categoryItems.map(item => `
                                    <tr>
                                        <td>${item.code}</td>
                                        <td>${item.name}</td>
                                        <td>${item.location}</td>
                                        <td>${item.condition}</td>
                                        <td>${item.quantity}</td>
                                        <td>${formatCurrency(item.price || 0)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }).join('');
        }
        
        function generateLocationReport() {
            const locations = [...new Set(items.map(item => item.location))];
            
            return locations.map(location => {
                const locationItems = items.filter(item => item.location === location);
                const totalValue = locationItems.reduce((sum, item) => sum + ((item.price || 0) * item.quantity), 0);
                
                return `
                    <div class="location-section">
                        <h3>Lokasi: ${location}</h3>
                        <p><strong>Total Barang:</strong> ${locationItems.length} jenis, ${locationItems.reduce((sum, item) => sum + item.quantity, 0)} unit</p>
                        <p><strong>Total Nilai:</strong> ${formatCurrency(totalValue)}</p>
                        
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>Kode</th>
                                    <th>Nama</th>
                                    <th>Kategori</th>
                                    <th>Kondisi</th>
                                    <th>Jumlah</th>
                                    <th>Harga</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${locationItems.map(item => `
                                    <tr>
                                        <td>${item.code}</td>
                                        <td>${item.name}</td>
                                        <td>${item.category}</td>
                                        <td>${item.condition}</td>
                                        <td>${item.quantity}</td>
                                        <td>${formatCurrency(item.price || 0)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }).join('');
        }
        
        function generateConditionReport() {
            const conditions = ['Baik', 'Rusak Ringan', 'Rusak Berat'];
            
            return conditions.map(condition => {
                const conditionItems = items.filter(item => item.condition === condition);
                const totalValue = conditionItems.reduce((sum, item) => sum + ((item.price || 0) * item.quantity), 0);
                
                return `
                    <div class="condition-section">
                        <h3>Kondisi: ${condition}</h3>
                        <p><strong>Total Barang:</strong> ${conditionItems.length} jenis, ${conditionItems.reduce((sum, item) => sum + item.quantity, 0)} unit</p>
                        <p><strong>Total Nilai:</strong> ${formatCurrency(totalValue)}</p>
                        
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>Kode</th>
                                    <th>Nama</th>
                                    <th>Kategori</th>
                                    <th>Lokasi</th>
                                    <th>Jumlah</th>
                                    <th>Harga</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${conditionItems.map(item => `
                                    <tr>
                                        <td>${item.code}</td>
                                        <td>${item.name}</td>
                                        <td>${item.category}</td>
                                        <td>${item.location}</td>
                                        <td>${item.quantity}</td>
                                        <td>${formatCurrency(item.price || 0)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }).join('');
        }
        
        function generateValueReport() {
            const sortedItems = [...items].sort((a, b) => ((b.price || 0) * b.quantity) - ((a.price || 0) * a.quantity));
            const totalValue = items.reduce((sum, item) => sum + ((item.price || 0) * item.quantity), 0);
            
            return `
                <div class="value-report">
                    <h2>Laporan Nilai Aset</h2>
                    <p><strong>Total Nilai Keseluruhan:</strong> ${formatCurrency(totalValue)}</p>
                    
                    <h3>Barang dengan Nilai Tertinggi</h3>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Ranking</th>
                                <th>Kode</th>
                                <th>Nama</th>
                                <th>Kategori</th>
                                <th>Lokasi</th>
                                <th>Jumlah</th>
                                <th>Harga Satuan</th>
                                <th>Total Nilai</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedItems.map((item, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${item.code}</td>
                                    <td>${item.name}</td>
                                    <td>${item.category}</td>
                                    <td>${item.location}</td>
                                    <td>${item.quantity}</td>
                                    <td>${formatCurrency(item.price || 0)}</td>
                                    <td><strong>${formatCurrency((item.price || 0) * item.quantity)}</strong></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function openReportWindow(title, content) {
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${title} - SAPRAS Digital</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.6;
                        }
                        .report-header {
                            text-align: center;
                            border-bottom: 2px solid #333;
                            padding-bottom: 20px;
                            margin-bottom: 30px;
                        }
                        .report-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 20px 0;
                        }
                        .report-table th,
                        .report-table td {
                            border: 1px solid #ddd;
                            padding: 8px;
                            text-align: left;
                        }
                        .report-table th {
                            background-color: #f2f2f2;
                            font-weight: bold;
                        }
                        .summary-stats {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                            gap: 15px;
                            margin: 20px 0;
                        }
                        .stat-item {
                            padding: 15px;
                            background: #f8f9fa;
                            border-radius: 5px;
                            border-left: 4px solid #007bff;
                        }
                        .category-section,
                        .location-section,
                        .condition-section {
                            margin: 30px 0;
                            page-break-inside: avoid;
                        }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="report-header">
                        <h1>SMK NASIONAL BANDUNG</h1>
                        <h2>${title}</h2>
                        <p>Generated on: ${new Date().toLocaleDateString('id-ID', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        })}</p>
                    </div>
                    
                    ${content}
                    
                    <div class="no-print" style="margin-top: 30px; text-align: center;">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            üñ®Ô∏è Print Laporan
                        </button>
                    </div>
                </body>
                </html>
            `);
        }
        
        function copyToClipboard(data, format) {
            try {
                navigator.clipboard.writeText(data);
                showNotification(`Data ${format} berhasil disalin ke clipboard!`, 'success');
            } catch (err) {
                // Fallback method
                const textArea = document.createElement('textarea');
                textArea.value = data;
                textArea.style.position = 'fixed';
                textArea.style.top = '50%';
                textArea.style.left = '50%';
                textArea.style.transform = 'translate(-50%, -50%)';
                textArea.style.width = '80%';
                textArea.style.height = '60%';
                textArea.style.zIndex = '9999';
                textArea.style.background = 'white';
                textArea.style.border = '2px solid #3b82f6';
                textArea.style.borderRadius = '8px';
                textArea.style.padding = '1rem';
                
                document.body.appendChild(textArea);
                textArea.select();
                textArea.focus();
                
                showNotification(`Silakan copy manual data ${format} dari text area!`, 'success');
                
                setTimeout(() => {
                    if (document.body.contains(textArea)) {
                        document.body.removeChild(textArea);
                    }
                }, 10000);
            }
        }
        
        function openMaintenanceSchedule() {
            document.getElementById('maintenanceModal').classList.add('active');
            generateMaintenanceSchedule();
        }
        
        function closeMaintenanceModal() {
            document.getElementById('maintenanceModal').classList.remove('active');
        }
        
        function generateMaintenanceSchedule() {
            const maintenanceList = document.getElementById('maintenanceList');
            const urgentItems = items.filter(item => item.condition === 'Rusak Berat');
            const scheduledItems = items.filter(item => item.condition === 'Rusak Ringan');
            const goodItems = items.filter(item => item.condition === 'Baik');
            
            document.getElementById('urgentMaintenance').textContent = urgentItems.length;
            document.getElementById('scheduledMaintenance').textContent = scheduledItems.length;
            document.getElementById('completedMaintenance').textContent = goodItems.length;
            
            const allMaintenanceItems = [
                ...urgentItems.map(item => ({ ...item, priority: 'urgent', status: 'Perlu Segera' })),
                ...scheduledItems.map(item => ({ ...item, priority: 'scheduled', status: 'Terjadwal' })),
                ...goodItems.slice(0, 5).map(item => ({ ...item, priority: 'completed', status: 'Maintenance Rutin' }))
            ];
            
            maintenanceList.innerHTML = allMaintenanceItems.map(item => `
                <div class="maintenance-item p-4 border rounded-lg ${item.priority === 'urgent' ? 'border-red-300 bg-red-50' : item.priority === 'scheduled' ? 'border-yellow-300 bg-yellow-50' : 'border-green-300 bg-green-50'}">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="font-semibold text-gray-800">${item.name}</div>
                            <div class="text-sm text-gray-600">Kode: ${item.code} | Lokasi: ${item.location}</div>
                            <div class="text-sm">
                                <span class="badge badge-${item.priority === 'urgent' ? 'danger' : item.priority === 'scheduled' ? 'warning' : 'success'}">${item.status}</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-medium ${item.priority === 'urgent' ? 'text-red-600' : item.priority === 'scheduled' ? 'text-yellow-600' : 'text-green-600'}">
                                ${item.condition}
                            </div>
                            <div class="text-xs text-gray-500">
                                ${item.priority === 'urgent' ? '‚ö†Ô∏è Prioritas Tinggi' : item.priority === 'scheduled'
